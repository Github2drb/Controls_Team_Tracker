
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Team Project Tracker</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --primary: #2f7bf5;
      --bg: #f7f9fc;
      --text: #1f2937;
      --muted: #6b7280;
      --border: #e5e7eb;
      --good: #16a34a;
      --warn: #f59e0b;
      --bad: #ef4444;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
    }
    body { margin: 0; background: var(--bg); color: var(--text); }
    header { background: white; border-bottom: 1px solid var(--border); padding: 16px 20px; position: sticky; top: 0; z-index: 10; }
    header h1 { margin: 0 0 4px; font-size: 20px; }
    header p { margin: 0; color: var(--muted); font-size: 13px; }

    .container { max-width: 1080px; margin: 24px auto; padding: 0 20px; }
    .toolbar { display: grid; grid-template-columns: 180px 1fr auto; gap: 12px; align-items: center; margin-bottom: 16px; }
    select, input, button, textarea {
      border: 1px solid var(--border); border-radius: 8px; padding: 10px; font-size: 14px; background: white;
    }
    button.primary { background: var(--primary); color: white; border: none; }
    button.ghost { background: white; color: var(--primary); border: 1px solid var(--primary); }
    button:disabled { opacity: .5; cursor: not-allowed; }

    /* Calendar */
    .calendar-wrap { background: white; border: 1px solid var(--border); border-radius: 12px; padding: 16px; margin-bottom: 20px; }
    .cal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px; }
    .cal-title { font-weight: 600; }
    .cal-actions { display: flex; gap: 8px; }
    .cal-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 6px; }
    .cal-day, .cal-dow { text-align: center; padding: 10px; border-radius: 8px; }
    .cal-dow { font-weight: 600; color: var(--muted); }
    .cal-day { background: #fafafa; border: 1px solid var(--border); position: relative; }
    .cal-day.today { outline: 2px solid var(--primary); }
    .cal-day.has-activity::after {
      content: "‚Ä¢";
      position: absolute; bottom: 6px; right: 8px; color: var(--good); font-weight: 700;
    }

    /* Modal */
    .modal-backdrop { position: fixed; inset: 0; background: rgba(0,0,0,.35); display: none; align-items: center; justify-content: center; z-index: 100; }
    .modal { width: 520px; max-width: 92vw; background: white; border-radius: 12px; border: 1px solid var(--border); overflow: hidden; }
    .modal header { padding: 12px 16px; border-bottom: 1px solid var(--border); }
    .modal header h3 { margin: 0; font-size: 16px; }
    .modal .body { padding: 16px; display: grid; gap: 10px; }
    .modal .footer { padding: 12px 16px; border-top: 1px solid var(--border); display: flex; justify-content: flex-end; gap: 8px; }
    .inline { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
    .muted { color: var(--muted); font-size: 12px; }

    /* Table (placeholder for Assignments list) */
    table { width: 100%; border-collapse: collapse; background: white; border: 1px solid var(--border); border-radius: 12px; overflow: hidden; }
    th, td { padding: 10px; border-bottom: 1px solid var(--border); font-size: 14px; }
    th { background: #f3f4f6; text-align: left; }
    tr:last-child td { border-bottom: none; }
  </style>
</head>
<body>
  <header>
    <h1>Team Project Tracker</h1>
    <p>Track project assignments and daily activities</p>
  </header>

  <main class="container">
    <!-- Toolbar: Filter -->
    <div class="toolbar">
      <select id="filterBy">
        <option value="all">Filter By</option>
        <option value="project">By Project</option>
        <option value="engineer">By Engineer</option>
      </select>

      <select id="engineerSelect" style="display:none">
        <option value="">Select Engineer...</option>
      </select>

      <div style="display:flex; gap:8px;">
        <button id="downloadJson" class="ghost">üì• Download JSON</button>
        <button id="clearData" class="ghost">üóëÔ∏è Clear All Data</button>
      </div>
    </div>

    <!-- === NEW: Calendar panel appears at top when an engineer is selected === -->
    <section id="calendarSection" class="calendar-wrap" style="display:none">
      <div class="cal-header">
        <div class="cal-title">
          <span id="calendarTitle">Calendar</span>
          <span class="muted" id="calendarEngineer"></span>
        </div>
        <div class="cal-actions">
          <button id="prevMonth" class="ghost">‚óÄ</button>
          <button id="nextMonth" class="ghost">‚ñ∂</button>
          <button id="todayTaskBtn" class="primary">‚ûï Today‚Äôs Task</button>
        </div>
      </div>
      <div class="cal-grid" id="calGridDOW"></div>
      <div class="cal-grid" id="calGrid"></div>
    </section>

    <!-- Assignments table (you can wire your existing data here) -->
    <h3>All Active Assignments</h3>
    <table id="assignmentsTable">
      <thead>
        <tr>
          <th>Project Name</th>
          <th>Engineer</th>
          <th>Start Date</th>
          <th>End Date</th>
          <th>Status</th>
          <th>Notes</th>
        </tr>
      </thead>
      <tbody id="assignmentsBody">
        <tr><td colspan="6">No projects added yet.</td></tr>
      </tbody>
    </table>
  </main>

  <!-- === NEW: Modal for Today‚Äôs Task === -->
  <div class="modal-backdrop" id="modalBackdrop" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
    <div class="modal">
      <header>
        <h3 id="modalTitle">Update Activity for <span id="modalDate"></span></h3>
      </header>
      <div class="body">
        <div class="inline">
          <div>
            <label>Engineer</label>
            <input type="text" id="modalEngineer" disabled />
          </div>
          <div>
            <label>Status</label>
            <select id="modalStatus">
              <option value="In Progress">In Progress</option>
              <option value="Completed">Completed</option>
              <option value="On Hold">On Hold</option>
              <option value="At Risk">At Risk</option>
            </select>
          </div>
        </div>
        <div>
          <label>Task / Activity</label>
          <input type="text" id="modalTask" placeholder="e.g., Commissioning PLC panel, site visit, design review" />
        </div>
        <div class="inline">
          <div>
            <label>Hours</label>
            <input type="number" id="modalHours" min="0" step="0.5" placeholder="e.g., 3.5" />
          </div>
          <div>
            <label>Notes</label>
            <input type="text" id="modalNotes" placeholder="Optional notes" />
          </div>
        </div>
        <p class="muted">Saving will store this entry under the engineer for the current date in the JSON dataset.</p>
      </div>
      <div class="footer">
        <button class="ghost" id="cancelModal">Cancel</button>
        <button class="primary" id="saveModal">Save</button>
      </div>
    </div>
  </div>

  <script>
    // === Simple data store (client-side). If you have a backend, see notes below. ===
    const DEFAULT_DATA = {
      assignments: [
        // Sample to populate engineer dropdown; replace with your real assignments or leave empty
        { projectName: "APC Panel Upgrade", engineer: "Anand Kumar", startDate: "2025-11-24", endDate: "2025-12-03", status: "In Progress", notes: "" },
        { projectName: "VFD Commissioning", engineer: "Meera S", startDate: "2025-11-28", endDate: "2025-12-05", status: "In Progress", notes: "" },
        { projectName: "SCADA Integration", engineer: "Ravi P", startDate: "2025-11-20", endDate: "2025-12-10", status: "At Risk", notes: "Vendor delay" }
      ],
      activities: {
        // engineer: { "YYYY-MM-DD": [ {task, status, hours, notes, ts} ] }
      }
    };

    function loadData() {
      const raw = localStorage.getItem("tpt_data");
      try {
        return raw ? JSON.parse(raw) : DEFAULT_DATA;
      } catch {
        return DEFAULT_DATA;
      }
    }
    function saveData() {
      localStorage.setItem("tpt_data", JSON.stringify(DATA));
    }

    let DATA = loadData();

    // DOM refs
    const filterBy = document.getElementById("filterBy");
    const engineerSelect = document.getElementById("engineerSelect");
    const calendarSection = document.getElementById("calendarSection");
    const calendarTitle = document.getElementById("calendarTitle");
    const calendarEngineer = document.getElementById("calendarEngineer");
    const calGrid = document.getElementById("calGrid");
    const calGridDOW = document.getElementById("calGridDOW");
    const prevMonthBtn = document.getElementById("prevMonth");
    const nextMonthBtn = document.getElementById("nextMonth");
    const todayTaskBtn = document.getElementById("todayTaskBtn");

    const modalBackdrop = document.getElementById("modalBackdrop");
    const modalDate = document.getElementById("modalDate");
    const modalEngineer = document.getElementById("modalEngineer");
    const modalStatus = document.getElementById("modalStatus");
    const modalTask = document.getElementById("modalTask");
    const modalHours = document.getElementById("modalHours");
    const modalNotes = document.getElementById("modalNotes");
    const cancelModal = document.getElementById("cancelModal");
    const saveModal = document.getElementById("saveModal");

    const assignmentsBody = document.getElementById("assignmentsBody");
    const downloadJsonBtn = document.getElementById("downloadJson");
    const clearDataBtn = document.getElementById("clearData");

    // Helpers
    const DOW = ["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];
    function ymd(dateObj = new Date()) { // local YYYY-MM-DD
      const y = dateObj.getFullYear();
      const m = String(dateObj.getMonth()+1).padStart(2,'0');
      const d = String(dateObj.getDate()).padStart(2,'0');
      return `${y}-${m}-${d}`;
    }
    function safeEngineerKey(name) {
      return name.trim();
    }
    function ensureEngineerActivities(name) {
      const key = safeEngineerKey(name);
      if (!DATA.activities[key]) DATA.activities[key] = {};
    }
    function getEngineerList() {
      const fromAssignments = (DATA.assignments || []).map(a => a.engineer);
      const fromActivities = Object.keys(DATA.activities || {});
      return Array.from(new Set([...fromAssignments, ...fromActivities])).sort();
    }

    // Render assignments (simple)
    function renderAssignments() {
      const rows = (DATA.assignments || []).map(a => `
        <tr>
          <td>${a.projectName}</td>
          <td>${a.engineer}</td>
          <td>${a.startDate}</td>
          <td>${a.endDate}</td>
          <td>${a.status}</td>
          <td>${a.notes || ""}</td>
        </tr>
      `).join("");
      assignmentsBody.innerHTML = rows || `<tr><td colspan="6">No projects added yet.</td></tr>`;
    }

    // Populate engineer dropdown
    function renderEngineerSelect() {
      const list = getEngineerList();
      engineerSelect.innerHTML = `<option value="">Select Engineer...</option>` +
        list.map(n => `<option value="${n}">${n}</option>`).join("");
    }

    // Calendar state
    let calMonth = (new Date()).getMonth();
    let calYear = (new Date()).getFullYear();

    function renderCalendar(selectedEngineer) {
      calendarSection.style.display = selectedEngineer ? "block" : "none";
      if (!selectedEngineer) return;

      calendarTitle.textContent = `${new Date(calYear, calMonth, 1).toLocaleString([], { month: 'long', year: 'numeric' })}`;
      calendarEngineer.textContent = `‚Ä¢ ${selectedEngineer}`;

      // Days of Week
      calGridDOW.innerHTML = DOW.map(d => `<div class="cal-dow">${d}</div>`).join("");

      // Build month grid
      const first = new Date(calYear, calMonth, 1);
      const startIdx = first.getDay(); // 0..6
      const daysInMonth = new Date(calYear, calMonth+1, 0).getDate();
      const todayStr = ymd(new Date());

      // Activities for engineer
      ensureEngineerActivities(selectedEngineer);
      const acts = DATA.activities[safeEngineerKey(selectedEngineer)] || {};

      const cells = [];
      for (let i=0; i<startIdx; i++) cells.push(`<div></div>`);
      for (let d=1; d<=daysInMonth; d++) {
        const dateStr = ymd(new Date(calYear, calMonth, d));
        const has = Array.isArray(acts[dateStr]) && acts[dateStr].length > 0;
        const isToday = (dateStr === todayStr);
        cells.push(`
          <div class="cal-day ${isToday ? 'today':''} ${has ? 'has-activity':''}" data-date="${dateStr}">
            <div>${d}</div>
          </div>
        `);
      }
      calGrid.innerHTML = cells.join("");

      // Optional: click a day to preview activities
      Array.from(calGrid.querySelectorAll(".cal-day[data-date]")).forEach(el => {
        el.addEventListener("click", () => {
          const dateStr = el.getAttribute("data-date");
          previewDayActivities(selectedEngineer, dateStr);
        });
      });
    }

    function previewDayActivities(engineer, dateStr) {
      ensureEngineerActivities(engineer);
      const entries = DATA.activities[safeEngineerKey(engineer)][dateStr] || [];
      const msg = entries.length
        ? entries.map(e => `‚Ä¢ ${e.task} (${e.status}, ${e.hours ?? 0}h)${e.notes ? " ‚Äì " + e.notes : ""}`).join("\n")
        : "No activities for this date.";
      alert(`[${engineer}] ${dateStr}\n\n${msg}`);
    }

    // Modal control
    function openModal(engineer, dateStr) {
      modalEngineer.value = engineer;
      modalDate.textContent = dateStr;
      modalStatus.value = "In Progress";
      modalTask.value = "";
      modalHours.value = "";
      modalNotes.value = "";
      modalBackdrop.style.display = "flex";
    }
    function closeModal() {
      modalBackdrop.style.display = "none";
    }

    // Save activity
    function saveActivity(engineer, dateStr, activity) {
      ensureEngineerActivities(engineer);
      const key = safeEngineerKey(engineer);
      if (!Array.isArray(DATA.activities[key][dateStr])) {
        DATA.activities[key][dateStr] = [];
      }
      DATA.activities[key][dateStr].push({ ...activity, ts: new Date().toISOString() });
      saveData();
      renderCalendar(engineer);
    }

    // Event wiring
    filterBy.addEventListener("change", () => {
      const mode = filterBy.value;
      const showEngineer = (mode === "engineer");
      engineerSelect.style.display = showEngineer ? "block" : "none";
      calendarSection.style.display = "none";
      if (showEngineer) {
        renderEngineerSelect();
      }
    });

    engineerSelect.addEventListener("change", () => {
      const engineer = engineerSelect.value;
      if (!engineer) {
        calendarSection.style.display = "none";
        return;
      }
      calMonth = (new Date()).getMonth();
      calYear = (new Date()).getFullYear();
      renderCalendar(engineer);
    });

    prevMonthBtn.addEventListener("click", () => {
      calMonth--;
      if (calMonth < 0) { calMonth = 11; calYear--; }
      renderCalendar(engineerSelect.value);
    });
    nextMonthBtn.addEventListener("click", () => {
      calMonth++;
      if (calMonth > 11) { calMonth = 0; calYear++; }
      renderCalendar(engineerSelect.value);
    });

    todayTaskBtn.addEventListener("click", () => {
      const engineer = engineerSelect.value;
      if (!engineer) return alert("Please select an engineer first.");
      openModal(engineer, ymd(new Date()));
    });

    cancelModal.addEventListener("click", closeModal);
    modalBackdrop.addEventListener("click", (e) => {
      if (e.target === modalBackdrop) closeModal();
    });

    saveModal.addEventListener("click", () => {
      const engineer = modalEngineer.value;
      const dateStr = modalDate.textContent;
      const task = modalTask.value.trim();
      const status = modalStatus.value;
      const hours = parseFloat(modalHours.value);
      const notes = modalNotes.value.trim();

      if (!task) return alert("Please enter a task/activity.");
      const activity = { task, status, hours: isNaN(hours) ? 0 : hours, notes };
      saveActivity(engineer, dateStr, activity);
      closeModal();
      alert("Activity saved.");
    });

    // Download JSON
    downloadJsonBtn.addEventListener("click", () => {
      const blob = new Blob([JSON.stringify(DATA, null, 2)], { type: "application/json" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "data.json";
      document.body.appendChild(a);
      a.click();
      a.remove();
      URL.revokeObjectURL(url);
    });

    // Clear data
    clearDataBtn.addEventListener("click", () => {
      if (!confirm("Clear all local data?")) return;
      localStorage.removeItem("tpt_data");
      DATA = loadData();
      renderAssignments();
      renderEngineerSelect();
      calendarSection.style.display = "none";
      filterBy.value = "all";
      alert("Cleared. Sample data reloaded.");
    });

    // Init
    renderAssignments();
    renderEngineerSelect();
  </script>
</body>
</html>
