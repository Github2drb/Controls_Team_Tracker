<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Team Project Tracker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lucide.js/0.263.1/umd/lucide.min.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
        }
        .icon-inline {
            display: inline-block;
            width: 20px;
            height: 20px;
            margin-right: 0.5rem;
        }
        .calendar-day {
            min-height: 80px;
            position: relative;
        }
        .project-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            display: inline-block;
            margin: 1px;
        }
    </style>
</head>
<body class="bg-gradient-to-br from-slate-900 to-slate-800 min-h-screen p-6">
    <div class="max-w-7xl mx-auto">
        <!-- Header with Tabs -->
        <div class="mb-8 flex justify-between items-center">
            <div>
                <h1 class="text-4xl font-bold text-white mb-2">Team Project Tracker</h1>
                <p class="text-slate-300">Track project assignments and monitor team progress</p>
            </div>
            <button id="adminToggle" onclick="toggleAdminAuth()" class="px-4 py-2 bg-slate-700 text-white rounded-lg hover:bg-slate-600 transition font-medium text-sm">
                üîê Admin Panel
            </button>
        </div>

        <!-- Admin Auth Modal -->
        <div id="adminAuthModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
            <div class="bg-white rounded-lg shadow-xl max-w-md w-full p-6">
                <h2 class="text-2xl font-bold text-slate-900 mb-4">Admin Panel Access</h2>
                <p class="text-slate-600 mb-4">Enter the admin password to access the admin panel</p>
                <div class="mb-4">
                    <label class="block text-sm font-medium text-slate-700 mb-2">Password</label>
                    <input type="password" id="adminPassword" placeholder="Enter password" class="w-full px-4 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                <div class="flex gap-3">
                    <button onclick="verifyAdminPassword()" class="flex-1 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition font-medium">
                        Access Admin
                    </button>
                    <button onclick="closeAdminAuth()" class="flex-1 px-4 py-2 bg-slate-600 text-white rounded-lg hover:bg-slate-700 transition font-medium">
                        Cancel
                    </button>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div id="mainContent">
            <!-- Filter Section -->
            <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
                <h2 class="text-lg font-semibold text-slate-900 mb-4">üîç View Active Assignments</h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-2">Filter By</label>
                        <select id="filterType" onchange="updateFilterOptions()" class="w-full px-3 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <option value="all">All Assignments</option>
                            <option value="project">By Project</option>
                            <option value="engineer">By Engineer</option>
                        </select>
                    </div>
                    <div id="filterSelectContainer" class="hidden">
                        <label class="block text-sm font-medium text-slate-700 mb-2">Select Option</label>
                        <select id="filterValue" onchange="renderTable()" class="w-full px-3 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <option value="">Choose...</option>
                        </select>
                    </div>
                    <div class="flex items-end">
                        <button onclick="clearFilters()" class="w-full px-4 py-2 bg-slate-600 text-white rounded-lg hover:bg-slate-700 transition font-medium">
                            Clear Filters
                        </button>
                    </div>
                </div>
            </div>

            <!-- Week-wise Breakdown (shown only when filtering by engineer) -->
            <div id="weekWiseSection" class="hidden bg-white rounded-lg shadow-lg p-6 mb-8">
                <h2 class="text-xl font-semibold text-slate-900 mb-4">
                    üìÖ Week-wise Project Assignment for <span id="selectedEngineer" class="text-blue-600"></span>
                </h2>
                <div id="weekWiseContent" class="space-y-4"></div>
            </div>

            <!-- Calendar View (shown only when filtering by engineer) -->
            <div id="calendarSection" class="hidden bg-white rounded-lg shadow-lg p-6 mb-8">
                <h2 class="text-xl font-semibold text-slate-900 mb-4">
                    üóìÔ∏è Calendar View - Project Timeline for <span id="calendarEngineer" class="text-blue-600"></span>
                </h2>
                <div id="calendarContent" class="space-y-6"></div>
            </div>

            <!-- Dashboard Section -->
            <div class="bg-white rounded-lg shadow-lg overflow-hidden">
                <div class="p-6 border-b border-slate-200">
                    <h2 class="text-xl font-semibold text-slate-900">
                        <span id="tableTitle">All Active Assignments</span>
                        <span class="text-slate-500 text-lg ml-2">(<span id="tableCount">0</span>)</span>
                    </h2>
                </div>
                <div class="overflow-x-auto">
                    <table class="w-full" id="dataTable">
                        <thead class="bg-slate-50 border-b border-slate-200">
                            <tr>
                                <th class="px-6 py-3 text-left text-sm font-semibold text-slate-900">Project Name</th>
                                <th class="px-6 py-3 text-left text-sm font-semibold text-slate-900">Engineer</th>
                                <th class="px-6 py-3 text-left text-sm font-semibold text-slate-900">Start Date</th>
                                <th class="px-6 py-3 text-left text-sm font-semibold text-slate-900">End Date</th>
                                <th class="px-6 py-3 text-center text-sm font-semibold text-slate-900">Days Assigned</th>
                                <th class="px-6 py-3 text-center text-sm font-semibold text-slate-900">Remaining Days</th>
                                <th class="px-6 py-3 text-center text-sm font-semibold text-slate-900">Status</th>
                                <th class="px-6 py-3 text-left text-sm font-semibold text-slate-900">Notes</th>
                                <th class="px-6 py-3 text-center text-sm font-semibold text-slate-900">Action</th>
                            </tr>
                        </thead>
                        <tbody id="tableBody" class="divide-y divide-slate-200">
                            <tr><td colspan="9" class="px-6 py-12 text-center text-slate-500 text-lg">No projects added yet. Start by adding a new project assignment above.</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Admin Panel Content -->
        <div id="adminPanel" class="hidden">
            <!-- Add New Project Assignment Form -->
            <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
                <h2 class="text-xl font-semibold text-slate-900 mb-4">‚ûï Add New Project Assignment</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-1">Project Name *</label>
                        <input type="text" id="projectName" placeholder="e.g., Website Redesign" class="w-full px-3 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-1">Team Engineer Name *</label>
                        <input type="text" id="engineerName" placeholder="e.g., John Doe" class="w-full px-3 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-1">Start Date *</label>
                        <input type="date" id="startDate" class="w-full px-3 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-1">End Date *</label>
                        <input type="date" id="endDate" class="w-full px-3 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-1">Status</label>
                        <select id="status" class="w-full px-3 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <option>In Progress</option>
                            <option>Completed</option>
                            <option>On Hold</option>
                            <option>At Risk</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-slate-700 mb-1">Notes</label>
                        <input type="text" id="notes" placeholder="Additional notes" class="w-full px-3 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div class="md:col-span-2 lg:col-span-3 flex gap-3 pt-2">
                        <button onclick="addProject()" class="flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition font-medium">
                            ‚ûï Add Assignment
                        </button>
                    </div>
                </div>
            </div>

            <!-- Cloud Storage Section -->
            <div class="bg-gradient-to-r from-purple-600 to-blue-600 rounded-lg shadow-lg p-6 mb-8 text-white">
                <div class="flex items-start justify-between mb-6">
                    <div class="flex items-center gap-3">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
                        </svg>
                        <div>
                            <h3 class="text-lg font-semibold">Live Data Sync</h3>
                            <p class="text-sm text-purple-100">Manage and sync data from JSON file</p>
                        </div>
                    </div>
                    <div class="text-right text-sm">
                        <p class="font-medium"><span id="adminAssignmentCount">0</span> active assignments</p>
                        <p class="text-purple-100 mt-1 text-xs" id="adminSyncStatus">Ready</p>
                    </div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
                    <button onclick="downloadJSON()" class="bg-white bg-opacity-20 hover:bg-opacity-30 px-4 py-2 rounded-lg transition font-medium text-sm">
                        üì• Download JSON
                    </button>
                    <button onclick="downloadCSV()" class="bg-white bg-opacity-20 hover:bg-opacity-30 px-4 py-2 rounded-lg transition font-medium text-sm">
                        üìä Export to CSV
                    </button>
                    <button onclick="clearAllData()" class="bg-red-500 hover:bg-red-600 px-4 py-2 rounded-lg transition font-medium text-sm">
                        üóëÔ∏è Clear All Data
                    </button>
                </div>
                <div class="mt-4 p-3 bg-white bg-opacity-10 rounded text-xs text-purple-100">
                    <p class="font-semibold mb-2">üí° How to use with GitHub:</p>
                    <p>1. Upload <span class="font-medium">index.html</span> and <span class="font-medium">data.json</span> to GitHub</p>
                    <p>2. Enable GitHub Pages in repository settings</p>
                    <p>3. Share the live link - data loads automatically from data.json</p>
                    <p>4. Update data.json in the repository to sync changes across all users</p>
                </div>
            </div>

            <!-- Admin Options -->
            <div class="bg-white rounded-lg shadow-lg p-6">
                <h2 class="text-xl font-semibold text-slate-900 mb-4">‚öôÔ∏è Admin Settings</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="bg-slate-50 p-4 rounded-lg">
                        <h3 class="font-semibold text-slate-900 mb-2">Change Admin Password</h3>
                        <div class="space-y-3">
                            <div>
                                <label class="block text-sm font-medium text-slate-700 mb-1">New Password</label>
                                <input type="password" id="newPassword" placeholder="Enter new password" class="w-full px-3 py-2 border border-slate-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                            </div>
                            <button onclick="changePassword()" class="w-full px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition font-medium">
                                Update Password
                            </button>
                        </div>
                    </div>
                    <div class="bg-slate-50 p-4 rounded-lg">
                        <h3 class="font-semibold text-slate-900 mb-2">Admin Actions</h3>
                        <div class="space-y-2">
                            <button onclick="exitAdmin()" class="w-full px-4 py-2 bg-slate-600 text-white rounded-lg hover:bg-slate-700 transition font-medium text-sm">
                                Exit Admin Panel
                            </button>
                            <button onclick="showCurrentPassword()" class="w-full px-4 py-2 bg-slate-500 text-white rounded-lg hover:bg-slate-600 transition font-medium text-sm">
                                View Current Password
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let projects = [];
        const DEFAULT_PASSWORD = 'admin123';

        // Load data from JSON file on page load
        async function loadDataFromJSON() {
            try {
                const response = await fetch('data.json');
                if (response.ok) {
                    const data = await response.json();
                    if (data.data && Array.isArray(data.data)) {
                        projects = data.data;
                        document.getElementById('adminSyncStatus').textContent = `‚úì Synced at ${new Date().toLocaleTimeString()}`;
                        renderTable();
                    }
                } else {
                    console.log('data.json not found - starting fresh');
                    document.getElementById('adminSyncStatus').textContent = 'No data.json found';
                }
            } catch (error) {
                console.log('Could not load data.json:', error);
                document.getElementById('adminSyncStatus').textContent = 'Starting fresh';
            }
        }

        function calculateDays(startDate, endDate) {
            const start = new Date(startDate);
            const end = new Date(endDate);
            const today = new Date();
            today.setHours(0, 0, 0, 0);

            const totalDays = Math.ceil((end - start) / (1000 * 60 * 60 * 24)) + 1;
            const assignedDays = Math.ceil((today - start) / (1000 * 60 * 60 * 24)) + 1;
            const remainingDays = Math.max(0, totalDays - assignedDays);

            return {
                total: totalDays,
                assigned: Math.max(0, assignedDays),
                remaining: remainingDays
            };
        }

        function addProject() {
            const projectName = document.getElementById('projectName').value;
            const engineerName = document.getElementById('engineerName').value;
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;
            const status = document.getElementById('status').value;
            const notes = document.getElementById('notes').value;

            if (!projectName || !engineerName || !startDate || !endDate) {
                alert('Please fill in all required fields');
                return;
            }

            const days = calculateDays(startDate, endDate);
            const newProject = {
                id: Date.now(),
                projectName,
                engineerName,
                startDate,
                endDate,
                totalDays: days.total,
                assignedDays: days.assigned,
                remainingDays: days.remaining,
                status,
                notes
            };

            projects.unshift(newProject);
            
            document.getElementById('projectName').value = '';
            document.getElementById('engineerName').value = '';
            document.getElementById('startDate').value = '';
            document.getElementById('endDate').value = '';
            document.getElementById('status').value = 'In Progress';
            document.getElementById('notes').value = '';
            
            renderTable();
            updateFilterOptions();
        }

        function deleteProject(id) {
            if (confirm('Are you sure you want to delete this assignment?')) {
                projects = projects.filter(p => p.id !== id);
                renderTable();
                updateFilterOptions();
            }
        }

        function getStatusColor(status) {
            const colors = {
                'Completed': 'bg-green-100 text-green-800',
                'On Hold': 'bg-yellow-100 text-yellow-800',
                'At Risk': 'bg-red-100 text-red-800',
                'In Progress': 'bg-blue-100 text-blue-800'
            };
            return colors[status] || colors['In Progress'];
        }

        function getFilteredProjects() {
            const filterType = document.getElementById('filterType').value;
            const filterValue = document.getElementById('filterValue').value;

            if (filterType === 'all' || !filterValue) return projects;
            if (filterType === 'project') return projects.filter(p => p.projectName === filterValue);
            if (filterType === 'engineer') return projects.filter(p => p.engineerName === filterValue);
            return projects;
        }

        function getWeekNumber(date) {
            const d = new Date(date);
            d.setHours(0, 0, 0, 0);
            d.setDate(d.getDate() + 4 - (d.getDay() || 7));
            const yearStart = new Date(d.getFullYear(), 0, 1);
            const weekNo = Math.ceil((((d - yearStart) / 86400000) + 1) / 7);
            return `${d.getFullYear()}-W${weekNo.toString().padStart(2, '0')}`;
        }

        function getWeekDateRange(weekString) {
            const [year, week] = weekString.split('-W');
            const simple = new Date(year, 0, 1 + (week - 1) * 7);
            const dow = simple.getDay();
            const ISOweekStart = simple;
            if (dow <= 4) ISOweekStart.setDate(simple.getDate() - simple.getDay() + 1);
            else ISOweekStart.setDate(simple.getDate() + 8 - simple.getDay());
            
            const weekEnd = new Date(ISOweekStart);
            weekEnd.setDate(weekEnd.getDate() + 6);
            
            return {
                start: ISOweekStart,
                end: weekEnd,
                label: `${ISOweekStart.toLocaleDateString('en-US', {month: 'short', day: 'numeric'})} - ${weekEnd.toLocaleDateString('en-US', {month: 'short', day: 'numeric', year: 'numeric'})}`
            };
        }

        function generateWeekWiseBreakdown(engineerName) {
            const engineerProjects = projects.filter(p => p.engineerName === engineerName);
            
            if (engineerProjects.length === 0) return;

            // Collect all weeks across all projects
            const weekProjectMap = {};

            engineerProjects.forEach(project => {
                const start = new Date(project.startDate);
                const end = new Date(project.endDate);
                let current = new Date(start);

                while (current <= end) {
                    const weekKey = getWeekNumber(current);
                    
                    if (!weekProjectMap[weekKey]) {
                        weekProjectMap[weekKey] = [];
                    }
                    
                    if (!weekProjectMap[weekKey].find(p => p.id === project.id)) {
                        weekProjectMap[weekKey].push(project);
                    }
                    
                    current.setDate(current.getDate() + 7);
                }
            });

            // Sort weeks chronologically
            const sortedWeeks = Object.keys(weekProjectMap).sort();

            const weekWiseContent = document.getElementById('weekWiseContent');
            weekWiseContent.innerHTML = sortedWeeks.map(weekKey => {
                const weekRange = getWeekDateRange(weekKey);
                const projectsInWeek = weekProjectMap[weekKey];

                return `
                    <div class="border border-slate-200 rounded-lg overflow-hidden">
                        <div class="bg-gradient-to-r from-blue-50 to-indigo-50 px-4 py-3 border-b border-slate-200">
                            <div class="flex justify-between items-center">
                                <div>
                                    <h3 class="font-semibold text-slate-900">${weekKey}</h3>
                                    <p class="text-sm text-slate-600">${weekRange.label}</p>
                                </div>
                                <div class="text-right">
                                    <span class="px-3 py-1 bg-blue-600 text-white rounded-full text-xs font-semibold">
                                        ${projectsInWeek.length} Project${projectsInWeek.length > 1 ? 's' : ''}
                                    </span>
                                </div>
                            </div>
                        </div>
                        <div class="p-4 space-y-3">
                            ${projectsInWeek.map(project => `
                                <div class="flex items-start gap-3 p-3 bg-slate-50 rounded-lg hover:bg-slate-100 transition">
                                    <div class="flex-shrink-0 w-2 h-2 rounded-full ${project.status === 'Completed' ? 'bg-green-500' : project.status === 'At Risk' ? 'bg-red-500' : project.status === 'On Hold' ? 'bg-yellow-500' : 'bg-blue-500'} mt-2"></div>
                                    <div class="flex-1 min-w-0">
                                        <div class="flex items-start justify-between gap-2">
                                            <div class="flex-1">
                                                <h4 class="font-semibold text-slate-900">${project.projectName}</h4>
                                                <div class="mt-1 flex flex-wrap gap-x-4 gap-y-1 text-sm text-slate-600">
                                                    <span>üìÖ ${project.startDate} to ${project.endDate}</span>
                                                    <span>‚è±Ô∏è ${project.assignedDays} days assigned</span>
                                                    <span>‚è≥ ${project.remainingDays} days remaining</span>
                                                </div>
                                                ${project.notes ? `<p class="mt-2 text-sm text-slate-600">üìù ${project.notes}</p>` : ''}
                                            </div>
                                            <span class="px-3 py-1 rounded-full text-xs font-semibold ${getStatusColor(project.status)} flex-shrink-0">
                                                ${project.status}
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            }).join('');

            document.getElementById('weekWiseSection').classList.remove('hidden');
            document.getElementById('selectedEngineer').textContent = engineerName;
        }

        function generateCalendarView(engineerName) {
            const engineerProjects = projects.filter(p => p.engineerName === engineerName);
            
            if (engineerProjects.length === 0) return;

            const today = new Date();
            const months = [];
            
            // Generate current month and next 2 months
            for (let i = 0; i < 3; i++) {
                const date = new Date(today.getFullYear(), today.getMonth() + i, 1);
                months.push(date);
            }

            const calendarContent = document.getElementById('calendarContent');
            calendarContent.innerHTML = months.map(monthDate => {
                const year = monthDate.getFullYear();
                const month = monthDate.getMonth();
                const monthName = monthDate.toLocaleDateString('en-US', { month: 'long', year: 'numeric' });
                
                // Get first day of month and number of days
                const firstDay = new Date(year, month, 1).getDay();
                const daysInMonth = new Date(year, month + 1, 0).getDate();
                
                // Create calendar grid
                const weeks = [];
                let currentWeek = new Array(7).fill(null);
                let dayCounter = 1;
                
                // Fill in the days
                for (let i = 0; i < 42; i++) { // 6 weeks max
                    const dayOfWeek = i % 7;
                    
                    if (i >= firstDay && dayCounter <= daysInMonth) {
                        const currentDate = new Date(year, month, dayCounter);
                        const dateStr = currentDate.toISOString().split('T')[0];
                        
                        // Find projects for this day
                        const projectsForDay = engineerProjects.filter(project => {
                            const start = new Date(project.startDate);
                            const end = new Date(project.endDate);
                            return currentDate >= start && currentDate <= end;
                        });
                        
                        currentWeek[dayOfWeek] = {
                            day: dayCounter,
                            date: dateStr,
                            projects: projectsForDay,
                            isToday: dateStr === today.toISOString().split('T')[0]
                        };
                        dayCounter++;
                    } else {
                        currentWeek[dayOfWeek] = null;
                    }
                    
                    if (dayOfWeek === 6) {
                        weeks.push([...currentWeek]);
                        currentWeek = new Array(7).fill(null);
                    }
                }
                
                return `
                    <div class="border border-slate-200 rounded-lg overflow-hidden">
                        <div class="bg-gradient-to-r from-purple-600 to-blue-600 px-4 py-3 text-white">
                            <h3 class="font-semibold text-lg">${monthName}</h3>
                        </div>
                        <div class="p-4">
                            <!-- Day headers -->
                            <div class="grid grid-cols-7 gap-2 mb-2">
                                ${['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'].map(day => 
                                    `<div class="text-center text-xs font-semibold text-slate-600 py-2">${day}</div>`
                                ).join('')}
                            </div>
                            
                            <!-- Calendar grid -->
                            <div class="grid grid-cols-7 gap-2">
                                ${weeks.map(week => 
                                    week.map(day => {
                                        if (!day) {
                                            return `<div class="calendar-day bg-slate-50 rounded"></div>`;
                                        }
                                        
                                        const todayClass = day.isToday ? 'ring-2 ring-blue-500' : '';
                                        const hasProjects = day.projects.length > 0;
                                        
                                        return `
                                            <div class="calendar-day bg-white border border-slate-200 rounded p-2 ${todayClass} ${hasProjects ? 'bg-blue-50' : ''}" title="${day.projects.map(p => p.projectName).join(', ')}">
                                                <div class="text-sm font-semibold text-slate-700 mb-1">${day.day}</div>
                                                ${hasProjects ? `
                                                    <div class="flex flex-wrap gap-1">
                                                        ${day.projects.map(project => {
                                                            let color = 'bg-blue-500';
                                                            if (project.status === 'Completed') color = 'bg-green-500';
                                                            else if (project.status === 'At Risk') color = 'bg-red-500';
                                                            else if (project.status === 'On Hold') color = 'bg-yellow-500';
                                                            return `<span class="project-dot ${color}" title="${project.projectName}"></span>`;
                                                        }).join('')}
                                                    </div>
                                                    <div class="mt-1 text-xs text-slate-600 truncate">
                                                        ${day.projects[0].projectName}
                                                        ${day.projects.length > 1 ? `<span class="font-semibold text-blue-600">+${day.projects.length - 1}</span>` : ''}
                                                    </div>
                                                ` : ''}
                                            </div>
                                        `;
                                    }).join('')
                                ).join('')}
                            </div>
                        </div>
                        
                        <!-- Legend -->
                        <div class="px-4 pb-4">
                            <div class="bg-slate-50 rounded-lg p-3">
                                <div class="text-xs font-semibold text-slate-700 mb-2">Project Status:</div>
                                <div class="flex flex-wrap gap-3 text-xs">
                                    <div class="flex items-center gap-1">
                                        <span class="project-dot bg-blue-500"></span>
                                        <span class="text-slate-600">In Progress</span>
                                    </div>
                                    <div class="flex items-center gap-1">
                                        <span class="project-dot bg-green-500"></span>
                                        <span class="text-slate-600">Completed</span>
                                    </div>
                                    <div class="flex items-center gap-1">
                                        <span class="project-dot bg-yellow-500"></span>
                                        <span class="text-slate-600">On Hold</span>
                                    </div>
                                    <div class="flex items-center gap-1">
                                        <span class="project-dot bg-red-500"></span>
                                        <span class="text-slate-600">At Risk</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');

            document.getElementById('calendarSection').classList.remove('hidden');
            document.getElementById('calendarEngineer').textContent = engineerName;
        }

        function renderTable() {
            const filterType = document.getElementById('filterType').value;
            const filterValue = document.getElementById('filterValue').value;
            const filtered = getFilteredProjects();
            const tbody = document.getElementById('tableBody');
            document.getElementById('tableCount').textContent = filtered.length;
            document.getElementById('adminAssignmentCount').textContent = projects.length;

            // Show week-wise breakdown only when filtering by engineer
            if (filterType === 'engineer' && filterValue) {
                generateWeekWiseBreakdown(filterValue);
                generateCalendarView(filterValue);
            } else {
                document.getElementById('weekWiseSection').classList.add('hidden');
                document.getElementById('calendarSection').classList.add('hidden');
            }

            if (filtered.length === 0) {
                tbody.innerHTML = '<tr><td colspan="9" class="px-6 py-12 text-center text-slate-500 text-lg">No projects added yet. Start by adding a new project assignment above.</td></tr>';
                return;
            }

            tbody.innerHTML = filtered.map(project => `
                <tr class="hover:bg-slate-50 transition">
                    <td class="px-6 py-4 text-sm font-medium text-slate-900">${project.projectName}</td>
                    <td class="px-6 py-4 text-sm text-slate-700">${project.engineerName}</td>
                    <td class="px-6 py-4 text-sm text-slate-700">${project.startDate}</td>
                    <td class="px-6 py-4 text-sm text-slate-700">${project.endDate}</td>
                    <td class="px-6 py-4 text-sm text-center font-semibold text-blue-600">${project.assignedDays}</td>
                    <td class="px-6 py-4 text-sm text-center font-semibold text-orange-600">${project.remainingDays}</td>
                    <td class="px-6 py-4 text-sm text-center">
                        <span class="px-3 py-1 rounded-full text-xs font-semibold ${getStatusColor(project.status)}">
                            ${project.status}
                        </span>
                    </td>
                    <td class="px-6 py-4 text-sm text-slate-700 max-w-xs truncate">${project.notes || '-'}</td>
                    <td class="px-6 py-4 text-center">
                        <button onclick="deleteProject(${project.id})" class="text-red-600 hover:text-red-800 transition" title="Delete">
                            üóëÔ∏è
                        </button>
                    </td>
                </tr>
            `).join('');
        }

        function updateFilterOptions() {
            const filterType = document.getElementById('filterType').value;
            const filterContainer = document.getElementById('filterSelectContainer');
            const filterValue = document.getElementById('filterValue');

            if (filterType === 'all') {
                filterContainer.classList.add('hidden');
            } else {
                filterContainer.classList.remove('hidden');
                
                let options = [];
                if (filterType === 'project') {
                    options = [...new Set(projects.map(p => p.projectName))].sort();
                } else if (filterType === 'engineer') {
                    options = [...new Set(projects.map(p => p.engineerName))].sort();
                }

                filterValue.innerHTML = '<option value="">Choose...</option>' + 
                    options.map(opt => `<option value="${opt}">${opt}</option>`).join('');
            }
            renderTable();
        }

        function clearFilters() {
            document.getElementById('filterType').value = 'all';
            document.getElementById('filterValue').value = '';
            document.getElementById('filterSelectContainer').classList.add('hidden');
            renderTable();
        }

        function downloadJSON() {
            if (projects.length === 0) {
                alert('No assignments to export');
                return;
            }

            const exportData = {
                exportDate: new Date().toISOString(),
                totalAssignments: projects.length,
                data: projects
            };

            const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `project_tracker_${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            window.URL.revokeObjectURL(url);
            document.body.removeChild(a);
        }

        function downloadCSV() {
            if (projects.length === 0) {
                alert('No assignments to export');
                return;
            }

            const headers = ['Project Name', 'Team Engineer Name', 'Start Date', 'End Date', 'Total Days', 'Days Assigned', 'Remaining Days', 'Status', 'Notes'];
            const rows = projects.map(p => [
                p.projectName, p.engineerName, p.startDate, p.endDate, p.totalDays, p.assignedDays, p.remainingDays, p.status, p.notes || ''
            ]);

            const csvContent = [
                headers.join(','),
                ...rows.map(row => row.map(cell => `"${cell}"`).join(','))
            ].join('\n');

            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `project_tracker_${new Date().toISOString().split('T')[0]}.csv`;
            document.body.appendChild(a);
            a.click();
            window.URL.revokeObjectURL(url);
            document.body.removeChild(a);
        }

        function clearAllData() {
            if (confirm('Are you sure you want to delete all data? This cannot be undone.')) {
                projects = [];
                renderTable();
                updateFilterOptions();
                document.getElementById('adminSyncStatus').textContent = 'All data cleared';
            }
        }

        // Admin Panel Functions
        function toggleAdminAuth() {
            document.getElementById('adminAuthModal').classList.remove('hidden');
            document.getElementById('adminPassword').value = '';
            document.getElementById('adminPassword').focus();
        }

        function closeAdminAuth() {
            document.getElementById('adminAuthModal').classList.add('hidden');
        }

        function verifyAdminPassword() {
            const password = document.getElementById('adminPassword').value;
            const storedPassword = localStorage.getItem('adminPassword') || DEFAULT_PASSWORD;

            if (password === storedPassword) {
                document.getElementById('adminAuthModal').classList.add('hidden');
                document.getElementById('mainContent').classList.add('hidden');
                document.getElementById('adminPanel').classList.remove('hidden');
            } else {
                alert('Incorrect password');
            }
        }

        function exitAdmin() {
            document.getElementById('adminPanel').classList.add('hidden');
            document.getElementById('mainContent').classList.remove('hidden');
        }

        function changePassword() {
            const newPassword = document.getElementById('newPassword').value;
            
            if (!newPassword) {
                alert('Please enter a new password');
                return;
            }

            localStorage.setItem('adminPassword', newPassword);
            alert('Password changed successfully!');
            document.getElementById('newPassword').value = '';
        }

        function showCurrentPassword() {
            const storedPassword = localStorage.getItem('adminPassword') || DEFAULT_PASSWORD;
            alert(`Current Admin Password: ${storedPassword}`);
        }

        // Allow Enter key to submit password
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('adminPassword')?.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') verifyAdminPassword();
            });
        });

        // Load data on page load
        window.addEventListener('load', loadDataFromJSON);
    </script>
</body>
</html>